task:
  trigger_type: manual
  matrix:
    - name: Linux - RD E2E/Integration Tests
      timeout_in: 60
      container:
        image: ubuntu:20.04
        kvm: true
        cpu: 4
        memory: 8G
      env:
        DEBIAN_FRONTEND: noninteractive
        CI: true
      install_deps_script: |
        apt-get update
        apt-get install -y --no-install-recommends apt-transport-https ca-certificates gcc g++ curl git golang openssh-client make netcat sudo qemu-system-x86 qemu-utils
        curl -fsSL https://deb.nodesource.com/setup_16.x | sudo -E bash - && apt-get install -y nodejs && node --version && npm -v
        apt-get install -y libgtk2.0-0 libgtk-3-0 libgbm-dev libnotify-dev libgconf-2-4 libnss3 libxss1 libasound2 libxtst6 xauth xvfb
  
  prepate_user_script: |
    useradd -m -G kvm rancheruser
    cp -rf . /home/rancheruser

  build_script: |
    chown -R rancheruser:rancheruser /home/rancheruser
    chown -R rancheruser:rancheruser /dev/kvm
    sudo -iu rancheruser npm install

  test_script: |
    export KUBECONFIG=/home/rancheruser/.kube/config
    export NODE_ENV=test
    sudo -iu rancheruser npm run test:e2e:ci

    